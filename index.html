<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Cotizaciones - SISDOKE</title>
    <link rel="stylesheet" href="css/output.css">
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
</head>
<body class="dark-theme">
    <div class="container">
        <header>
            <div class="logo"></div>
            <button id="new-sale-btn" class="new-sale-button" title="Iniciar nueva venta"><i class="fas fa-rotate-right"></i> Nueva Venta</button>
        </header>

        <main class="main-layout">
            <section id="input-column">
                
                <div class="card">
                    <h2>1. Buscar Material</h2>
                    <input type="text" id="search-input" placeholder="Buscar por código, marca..." class="large-input" autocomplete="off">
                    <div id="filter-buttons" class="filter-buttons">
                        <button class="filter-btn" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="vinil">Vinil</button>
                        <button class="filter-btn" data-filter="wrap">Wrap</button>
                        <button class="filter-btn" data-filter="polarizado">Polarizado</button>
                    </div>
                    <div id="search-results" class="search-results-dropdown"></div>
                </div>

                <!-- Nuevo Card: Datos del Cliente (Opcional) -->
                <div class="card" id="client-data-card">
                    <div class="client-data-header" id="client-data-header-clickable">
                        <h2>2. Datos del Cliente (Opcional)</h2>
                        <button class="collapse-toggle" id="collapse-client-data">▼</button>
                    </div>
                    <div class="client-data-content collapsed" id="client-data-content">
                        <input type="text" id="client-name-input" placeholder="Nombre del cliente" class="large-input" autocomplete="off">
                        <input type="tel" id="client-phone-input" placeholder="Teléfono" class="large-input" autocomplete="off">
                        <input type="email" id="client-email-input" placeholder="Email" class="large-input" autocomplete="off">
                        <input type="text" id="client-address-input" placeholder="Dirección" class="large-input" autocomplete="off">
                        <input type="text" id="client-ruc-input" placeholder="RUC/DNI" class="large-input" autocomplete="off">
                        <button id="clear-client-btn" class="clear-button" style="width: 100%; margin-top: 10px;"><i class="fas fa-trash"></i> Limpiar Datos</button>
                    </div>
                </div>

                <div class="card" id="item-form">
                    <div class="item-form-header" id="item-form-header-clickable" style="pointer-events: none; opacity: 0.5; cursor: not-allowed;">
                        <h2>3. Definir Trabajo</h2>
                        <button class="collapse-toggle" id="collapse-item-form" disabled style="cursor: not-allowed;">▼</button>
                    </div>
                    <div class="item-form-content collapsed" id="item-form-content">
                        <div id="editing-indicator" class="editing-indicator" style="display: none;">
                            <span><i class="fas fa-pen-to-square"></i> Modo: Agregar más del mismo producto</span>
                        </div>
                        <p id="selected-material-info" class="material-info"></p>
                        
                        <fieldset class="radio-group">
                            <legend>Base de Precio</legend>
                            <label><input type="radio" name="price-base" value="proveedor" id="rb-proveedor"> Proveedor</label>
                            <label><input type="radio" name="price-base" value="cliente" id="rb-cliente" checked> Cliente (Venta por Metro)</label>
                        </fieldset>

                        <input type="text" id="description-input" placeholder="Descripción (ej. Puerta conductor)" class="large-input" autocomplete="off">
                        <div class="input-group">
                            <input type="number" id="height-input" placeholder="Alto (cm)" class="large-input numeric-input" autocomplete="off">
                            <input type="number" id="width-input" placeholder="Ancho (cm)" class="large-input numeric-input" autocomplete="off">
                        </div>
                        <div class="area-cost-display">
                            <p class="area-display">Área: <span id="area-display">0.00</span> m²</p>
                            <p class="cost-display">Costo: <span id="cost-display">S/ 0.00</span></p>
                        </div>
                    </div>
                </div>

                <!-- Nuevo Card: Parámetros de Venta (Opcional) -->
                <div class="card" id="venta-params-card" style="display: none;">
                    <div class="venta-params-header" id="venta-params-header-clickable">
                        <h2>4. Parámetros de Venta (Opcional)</h2>
                        <button class="collapse-toggle" id="collapse-venta-params">▼</button>
                    </div>
                    <div class="venta-params-content collapsed" id="venta-params-content">
                        <div class="setting-item">
                            <label><input type="checkbox" id="vp-waste-active"> Aplicar Desperdicio (%):</label>
                            <input type="number" id="vp-waste-pct-input" placeholder="%" min="0" max="100" class="numeric-input small-input" autocomplete="off">
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox" id="vp-labor-active"> Aplicar Mano de Obra:</label>
                            <input type="number" id="vp-labor-cost-input" placeholder="Monto S/" min="0" class="numeric-input small-input" autocomplete="off">
                        </div>
                        <div class="setting-item profit-setting-item">
                            <label><input type="checkbox" id="vp-profit-active"> Aplicar Ganancia:</label>
                            <select id="vp-profit-type" class="small-input">
                                <option value="percent">%</option>
                                <option value="fixed">S/</option>
                            </select>
                            <input type="number" id="vp-profit-value-input" placeholder="Valor" min="0" class="numeric-input small-input" autocomplete="off">
                        </div>

                        <p class="area-display total-final">Precio Venta Pieza: <span id="preview-precio-venta">S/ 0.00</span></p>
                        
                        <button id="clear-venta-params-btn" class="clear-button" style="margin-top: 10px; width: 100%;"><i class="fas fa-trash"></i> Limpiar Parámetros</button>
                    </div>
                </div>

                <div class="button-group">
                    <button id="add-item-btn" class="large-button primary-button">Agregar a la cotización</button>
                    <button id="cancel-edit-btn" class="large-button secondary-button" style="display: none;">Cancelar Edición</button>
                </div>

            <section id="summary-column">

                <div class="card">
                    <h2>Trabajos Agregados</h2>
                    <div class="table-container"></div>
                        <table id="jobs-table">
                            <thead>
                                <tr>
                                    <th>Cód</th>
                                    <th>Descripción</th>
                                    <th>Área (m²)</th>
                                    <th>Costo Interno (S/)</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unit. (S/)</th>
                                    <th>Subtotal (S/)</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="jobs-table-skeleton">
                                <!-- Skeleton rows -->
                                <tr class="skeleton-row">
                                    <td><div class="skeleton skeleton-text"></div></td>
                                    <td><div class="skeleton skeleton-text"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-center"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-center"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-buttons"></div></td>
                                </tr>
                                <tr class="skeleton-row">
                                    <td><div class="skeleton skeleton-text"></div></td>
                                    <td><div class="skeleton skeleton-text"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-center"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-center"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-text skeleton-right"></div></td>
                                    <td><div class="skeleton skeleton-buttons"></div></td>
                                </tr>
                            </tbody>
                            <tbody id="jobs-table-body">
                                <!-- Las filas se insertarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                    <div id="jobs-cards-skeleton" class="jobs-cards-container">
                        <!-- Skeleton cards -->
                        <div class="job-card skeleton-card">
                            <div class="job-card-header">
                                <span class="skeleton skeleton-code"></span>
                                <span class="skeleton skeleton-desc"></span>
                            </div>
                            <div class="job-card-body">
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <div class="skeleton skeleton-qty"></div>
                                </div>
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                                <div class="job-card-row total">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                            </div>
                            <div class="job-card-footer">
                                <div class="skeleton skeleton-btn"></div>
                                <div class="skeleton skeleton-btn"></div>
                                <div class="skeleton skeleton-btn"></div>
                            </div>
                        </div>
                        <div class="job-card skeleton-card">
                            <div class="job-card-header">
                                <span class="skeleton skeleton-code"></span>
                                <span class="skeleton skeleton-desc"></span>
                            </div>
                            <div class="job-card-body">
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <div class="skeleton skeleton-qty"></div>
                                </div>
                                <div class="job-card-row">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                                <div class="job-card-row total">
                                    <span class="skeleton skeleton-label"></span>
                                    <span class="skeleton skeleton-value"></span>
                                </div>
                            </div>
                            <div class="job-card-footer">
                                <div class="skeleton skeleton-btn"></div>
                                <div class="skeleton skeleton-btn"></div>
                                <div class="skeleton skeleton-btn"></div>
                            </div>
                        </div>
                    </div>
                    <div id="jobs-cards-body" class="jobs-cards-container jobs-cards-body">
                        <!-- Las tarjetas se insertarán aquí dinámicamente en móvil -->
                    </div>
                    <div class="total-final-section">
                        <div class="total-final">
                            TOTAL FINAL: <span id="summary-total">S/0.00</span>
                        </div>
                    </div>
                    <button id="clear-jobs-btn" class="clear-button" style="width: 100%; margin-top: 10px;"><i class="fas fa-trash"></i> Limpiar Trabajos</button>
                </div>

                <div class="card">
                    <div class="notes-header" id="notes-header-clickable">
                        <h2>6. Notas (Opcionales)</h2>
                        <button class="collapse-toggle" id="collapse-notes">▼</button>
                    </div>
                    <div class="notes-content collapsed" id="notes-content">
                        <textarea id="final-notes" placeholder="Notas opcionales (ej. No bajar vidrios en 48hs)" class="large-textarea" autocomplete="off"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h2>7. Generar Salida</h2>
                    <div class="output-buttons-group">
                        <button id="generate-pdf-btn" class="output-button" title="Generar PDF (WhatsApp)"><i class="fas fa-file-pdf"></i> PDF</button>
                        <button id="print-thermal-btn" class="output-button" title="Imprimir Ticket (80mm)"><i class="fas fa-print"></i> Ticket</button>
                        <button id="print-generic-btn" class="output-button" title="Imprimir Genérico"><i class="fas fa-print"></i> Genérico</button>
                    </div>
                </div>

            </section>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="toast-notification"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/dataService.js"></script>
    <script src="js/uiController.js"></script>
    <script src="js/outputGenerator.js"></script>
    <script src="js/app.js"></script>
</body>
</html>